#############################################################
## !! WARNING!!!
#
#  These functions are shared between bash and zsh, don't
#  forget to test them in both shells.
#
#  If you need to do something specific for one or the other
#  move it in to either .profile (bash) or .zshrc (zsh).
#
#############################################################


function tm() {
        tmux attach-session || (cd ~/Development/; tmux )
}

#############################################################
# Encryption Fuctions
#############################################################
#
function decrypt {
        # decrypt if selected
        FILE=$1
        echo "-> decrypt: $(basename $FILE) "
        openssl enc -d -aes-256-cbc -salt -in "$FILE" -out "${FILE/.enc/}"
        FILE=""
}

function encrypt {
        # encrypt if selected
        FILE=$1
        echo "-> encrypt: $(basename $FILE) "
        openssl enc -e -aes-256-cbc -salt -in "$FILE" -out "$FILE.enc"
        FILE=""
}

#############################################################
# Function -- which to handle functions and aliases
#############################################################
#
function which {
    if ! /usr/bin/which $1
    then
        type $1 | head -1
    fi
}


#############################################################
# Function - quickly add strings to root .gitignore
#############################################################
#
function gitignore {
    echo "$1" >> $HOME/.gitignore
}


#############################################################
# Function - Finding files and directories
#############################################################
#
function ff() {
        find . -type f -name "*$1*"
}

function ffo() {
        find . -type f -name "*$1*" | xargs vim
}

function ffg() {
        find . -type f -name "*$1*" | xargs gvim -f
}

function fd() {
        echo "Running: find . -type f -name \"*$1*\""
        find . -type d -name "*$1*"
        echo " "
        echo "Done."
}

function fdo() {
        find . -type d -name "*$1*" | xargs vim
}

function fdg() {
        find . -type d -name "*$1*" | xargs gvim
}


#############################################################
# SSH Agent Setup
#############################################################
#
SSH_ENV="$HOME/.ssh/environment"

function start_agent {
     echo "Initialising new SSH agent..."
     /usr/bin/ssh-agent | sed 's/^echo/#echo/' > "${SSH_ENV}"
     echo succeeded
     chmod 600 "${SSH_ENV}"
     . "${SSH_ENV}" > /dev/null
     /usr/bin/ssh-add;
}

# Source SSH settings, if applicable
if [ -f "${SSH_ENV}" ]; then
     . "${SSH_ENV}" > /dev/null
     #ps ${SSH_AGENT_PID} doesn't work under cywgin
     ps -ef | grep ${SSH_AGENT_PID} | grep ssh-agent$ > /dev/null || {
         start_agent;
     }
else
     start_agent;
fi


function upload_yp_gem() {
        test -e $1 || exit 1
        echo "curl -T $1 http://mogwai:7700/gems.atti/gems/$( echo $1 | awk -F'/' '{ print $(NF-0) }' )"
        curl -T $1 http://mogwai:7700/gems.atti/gems/$( echo $1 | awk -F'/' '{ print $(NF-0) }' )
}

function svim() {
  /usr/bin/gvim -f "sudo:$@"
}

function svi() {
  /usr/bin/vim -f "sudo:$@"
}

function gvim() {
  /usr/bin/gvim -f "$@" &
}

function vim() {
  /usr/bin/gvim -f "$@" &
}

function gvimdiff() {
  /usr/bin/gvimdiff -f "$@" &
}

function vimdiff() {
  /usr/bin/gvimdiff -f "$@" &
}

function do_pry() {
  PRYCMD="$(which pry)"
  IRBCMD="$(which irb)"
  if test -e "$(which pry)"
  then
    echo "Starting $PRYCMD"
    $PRYCMD
  else
    echo "Starting $IRBCMD"
    $IRBCMD
  fi
}

function irb() {
  do_pry
}

function pry() {
  do_pry
}

function _irb() {
  command irb
}

function npm_exec() {
  PATH=$(npm bin):$PATH $@
}

function ypu {
  cd ~/Development/yp
}

function ypc {
  cd ~/Development/yp
}

function cms {
  cd ~/Development/personal/mervine.net/content/pages/
  rvm use ruby-1.9.3-p392
}

function tmp {
  cd ~/Development/tmp
}

function mail {
  nohup /usr/bin/chromium-browser \
    --user-agent="Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:23.0) Gecko/20100101 Firefox/23.0" \
    "http://mail.yp.com/" &> /dev/null &
}

function find {
  if [ `uname -s` = "Darwin" ]; then
    $browser="open"
  fi
  test "$browser" || browser=`which chromium-browser`
  test "$browser" || browser=`which google-chrome`
  test "$browser" || browser=`which firefox`
  query="`echo "$@" | sed -e 's:^[a-z\/\~\.]* ::' -e 's/-type [mg]//' -e 's/-name//'`"
  if [[ $@ =~ "-type m" ]]; then
    $browser "http://maps.google.com/?q=$query" 2>&1 > /dev/null &
  elif [[ $@ =~ "-type g" ]]; then
    $browser "http://www.google.com/search?q=$query" 2>&1 > /dev/null &
  else
    /usr/bin/find $@
  fi
}
